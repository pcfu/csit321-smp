<% content_for :assets do %>
  <%= javascript_pack_tag 'admin/prototype/index', 'data-turbolinks-track': 'reload' %>
<% end %>

<div class="container">
  <div class="row">
    <div class="col-12">
      <div class="my-5 text-center d-flex">
        <div class="col-6">
          <h3>Select stocks for training</h3>
          <%= check_box_tag(:AAPL, 1, false, class: 'model-training-option') %>
            <%= label_tag(:AAPL, "AAPL", class: 'training-option-label') %>
          <%= check_box_tag(:XOM, 2, false, class: 'model-training-option') %>
            <%= label_tag(:XOM, "XOM", class: 'training-option-label') %>
          <%= check_box_tag(:GSK, 3, false, class: 'model-training-option') %>
            <%= label_tag(:GSK, "GSK", class: 'training-option-label') %>
          <%= check_box_tag(:WPM, 4, false, class: 'model-training-option') %>
            <%= label_tag(:WPM, "WPM", class: 'training-option-label') %>
          <%= check_box_tag(:ALL, :ALL) %>
            <%= label_tag(:ALL, "All", class: 'training-option-label') %>

          <button id="training-button" class="btn btn-primary">Train</button>
        </div>

        <div class="col-6">
          <h3>Select stock for prediction</h3>
          <button id="prediction-button" class="btn btn-primary ms-5">Predict</button>
        </div>
      </div>

      <h2>Model Training Status</h2>
      <div class="mt-3 mb-5">
        <table id="model-config-table" class="table table-striped">
          <thead>
            <tr>
              <th scope="col">Model Name</th>
              <th scope="col">Training Progress</th>
              <th scope="col">Updated At</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td scope="col"><%= @config.name %></th>
              <td scope="col"><%= @config.train_percent %></th>
              <td scope="col"><%= @config.updated_at.strftime("%Y-%m-%d %H:%M:%S.%3N") %></th>
            </tr>
          </tbody>
        </table>
      </div>

      <h2>Latest Predictions</h2>
      <div class="my-3">
        <table id="predictions-table" class="table table-striped">
          <thead>
            <tr>
              <th scope="col">Stock</th>
              <th scope="col">Entry Date</th>
              <th scope="col">Next Day</th>
              <th scope="col">ND Max</th>
              <th scope="col">ND Exp</th>
              <th scope="col">ND Min</th>
              <th scope="col">Short Term</th>
              <th scope="col">ST Max</th>
              <th scope="col">ST Exp</th>
              <th scope="col">ST Min</th>
            </tr>
          </thead>
          <tbody>
            <% @predictions.each do |p| %>
              <% prices = p.to_chart_json %>
              <tr>
                <td><%= p.stock.symbol %></td>
                <td><%= prices[:entry_date] %></td>
                <td><%= prices[:nd_date] %></td>
                <td><%= prices[:nd_max_price] %></td>
                <td><%= prices[:nd_exp_price] %></td>
                <td><%= prices[:nd_min_price] %></td>
                <td><%= prices[:st_date] %></td>
                <td><%= prices[:st_max_price] %></td>
                <td><%= prices[:st_exp_price] %></td>
                <td><%= prices[:st_min_price] %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  .training-option-label {
    margin-right: 15px;
  }
</style>
